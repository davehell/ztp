{block title}Testovací protokol - Verze {$verze->nazev}{/block}

{block content}
<h1>Testovací protokol</h1>

<h2>Verze {$verze->nazev} <a n:if="$pohled == 'boss'" n:href="Verze:export, $verze->id, 'protokol' => 'testy', 'pohled' => null, 'filtr' => null" target="_blank" title="Export" class="btn btn-primary"><span class="glyphicon glyphicon-floppy-save"></span></a></h2>


<dl class="dl-horizontal">
  <dt>Datum</dt>
  <dd>{$verze->datum|date:'%d.%m.%Y'}</dd>
  {if $verze->pozn_verejna}
    <dt>Veřejné poznámky</dt>
    <dd>{!$verze->pozn_verejna|nl2br}</dd>
  {/if}
  {if $verze->pozn_skryta}
    <dt>Skryté poznámky</dt>
    <dd class="skryteInfo">{!$verze->pozn_skryta|nl2br}</dd>
  {/if}
</dl>

<h2>Testováno na</h2>
<dl n:inner-foreach="$testeriVeVerzi as $tester"  class="dl-horizontal">
  <dt>
    {$tester->tester->jmeno|upper}
  </dt>
  <dd>
    <a n:if="$pohled == 'test'" n:href="Verze:osoba $tester->tester_id" title="Upravit testovací prostředí u {$tester->tester->jmeno|upper}" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-pencil"></span></a>
    {$tester->tester->prostredi}
  </dd>
</dl>

<h2>Změny</h2>

<div n:if="$filtr" class="alert alert-info">
  Zobrazeny pouze změny
  {if $filtr == 'autor'} autora {$uziv|upper}
  {elseif $filtr == 'autor-chyby'} autora {$uziv|upper}, které neprošly testováním
  {elseif $filtr == 'tester'}, které testuje {$uziv|upper}
  {elseif $filtr == 'tester-chyby'}, které neprošly testováním a testuje je {$uziv|upper}
  {elseif $filtr == 'boss-chyby'}, které neprošly testováním
  {elseif $filtr == 'bez-testera'}, které nemají přiřazeného testera
  {/if}
</div>

{snippet zmeny}
{foreach $zmeny as $zmena}

<a name="z{$zmena->id}"></a>
<div class="zmena {if !$zmena->je_verejna}skryteInfo{/if}">
  <div class="row head">
    <div class="col-md-1">{control stav, $zmena->je_ok}</div>
    <div class="col-md-2"><div class="autor {if $pohled == 'dev' && $zmena->autor->jmeno == $uziv}moje{/if}">autor<br>{$zmena->autor->jmeno|upper}</div></div>
    <div class="col-md-2">{if $zmena->task}task<br>{$zmena->task}{/if}</div>
    {if $pohled == 'boss'}
      <div class="col-md-7">
        {control testeri, $zmena}
      </div>
    {else}
      <div class="col-md-2">
        <div n:if="$zmena->tester" class="tester  {if $pohled == 'test' && $zmena->tester->jmeno == $uziv}moje{/if}">
          tester<br>{$zmena->tester->jmeno|upper}
        </div>
      </div>
      <div class="col-md-3">
        {$zmena->vysledek_testu}
      </div>
      <div class="col-md-2">
        <div n:if="$pohled == 'test'" class="btn-toolbar">
          <div class="btn-group">
            <a n:href="Chyby:chyba, null, $zmena->id" title="Je tam chyba" class="btn btn-primary"><span class="glyphicon glyphicon-thumbs-down"></span></a>
            <a n:href="Zmeny:test, $zmena->id" title="Je to cajk" class="btn btn-primary"><span class="glyphicon glyphicon-thumbs-up"></span></a>
          </div>
        </div>
      </div>
    {/if}
  </div>
  <hr>
  <div class="row">
    <div class="col-md-12">
      <p>
        {$zmena->typy_zmen->nazev}: {!$zmena->text|nl2br}
      </p>
      <p n:if="$zmena->detail" class="{if $zmena->je_verejna}skryteInfo{/if}">
        {!$zmena->detail|nl2br}
      </p>
    </div>
  </div>
  <hr>
  <div class="row">
    <div class="col-md-12">
      {!$zmena->uloha|nl2br}
    </div>
  </div>
  {if $pohled == 'dev' || $pohled == 'test'}
    {control chyby, $zmena->id}
  {/if}
</div>

{/foreach}
{/snippet}
